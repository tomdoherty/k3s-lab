---
- name: ipv6 sysctl
  sysctl: name={{ item }} value=1 state=present
  with_items:
    - net.ipv6.conf.all.disable_ipv6
    - net.ipv6.conf.default.disable_ipv6
    - net.ipv6.conf.lo.disable_ipv6


- name: ipv6 blacklist
  lineinfile: "dest=/etc/modprobe.conf line='install ipv6 /bin/true' create=yes"


- name: Delete k3s if already present
  file:
    path: /usr/local/bin/k3s
    state: absent

- name: download k3s
  get_url:
    url: https://github.com/rancher/k3s/releases/download/{{ k3s_version }}/k3s
    checksum: "{{ k3s_hash }}"
    dest: /usr/local/bin/k3s
    mode: 755

- name: Create kubectl symlink
  file:
    src: /usr/local/bin/k3s
    dest: /usr/local/bin/kubectl
    state: link

- name: Create crictl symlink
  file:
    src: /usr/local/bin/k3s
    dest: /usr/local/bin/crictl
    state: link
